---
phase: 06-日志系统修复
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - main.go
autonomous: true

must_haves:
  truths:
    - "日志文件输出到程序根目录的 logs 文件夹"
    - "使用 os.Executable() 获取可执行文件路径"
    - "使用 filepath.Dir() 获取可执行文件所在目录"
    - "logs 文件夹不存在时自动创建"
  artifacts:
    - path: "main.go"
      provides: "日志输出路径配置"
      contains: "os.Executable"
      contains: "filepath.Join(exeDir, \"logs\")"
  key_links:
    - from: "main.go"
      to: "可执行文件目录/logs"
      via: "os.Executable() + filepath.Dir()"
      pattern: "filepath.Join.*logs"
---

<objective>
配置日志输出路径到程序根目录的 logs 文件夹，确保无论从哪里启动应用，日志文件都输出到可执行文件所在目录。

目的：解决日志文件位置不一致问题，用户可以在程序根目录找到所有日志文件。
输出：日志文件稳定输出到 `{exeDir}/logs/` 目录
</objective>

<execution_context>
@C:\Users\allan716\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\allan716\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-日志系统修复/06-日志系统修复-RESEARCH.md

# Prior decisions affecting this plan
- 日志输出路径：应输出到程序根目录的 logs 文件夹
- 程序根目录定义：可执行文件（.exe）所在目录
- 当前问题：main.go 使用用户主目录 `~/.ai-commit-hub/logs` 而非程序根目录
</context>

<tasks>

<task type="auto">
  <name>修改日志输出路径为程序根目录</name>
  <files>main.go</files>
  <action>
    在 initLogger() 函数中，将日志目录从用户主目录改为可执行文件所在目录。

    当前实现（第27-40行）使用用户主目录：
    ```go
    func initLogger() {
        // 获取用户主目录
        homeDir, err := os.UserHomeDir()
        if err != nil {
            logger.Errorf("Failed to get home directory: %v", err)
            return
        }

        // 创建日志目录
        logDir := filepath.Join(homeDir, ".ai-commit-hub", "logs")
        if err := os.MkdirAll(logDir, 0755); err != nil {
            logger.Errorf("Failed to create log directory: %v", err)
            return
        }
        // ...
    }
    ```

    修改为使用可执行文件目录：
    ```go
    func initLogger() {
        // 获取可执行文件所在目录（程序根目录）
        exePath, err := os.Executable()
        if err != nil {
            logger.Errorf("获取可执行文件路径失败: %v", err)
            return
        }
        exeDir := filepath.Dir(exePath)

        // 创建日志目录
        logDir := filepath.Join(exeDir, "logs")
        if err := os.MkdirAll(logDir, 0755); err != nil {
            logger.Errorf("创建日志目录失败: %v", err)
            return
        }

        // 配置 logger 输出到文件
        logger.SetLoggerSettings(
            &logger.Settings{
                LogRootFPath:     logDir,
                LogNameBase:      "app.log",
                MaxSizeMB:        100,
                MaxAgeDays:       30,
                FormatterType:    "withField",
                TimestampFormat:  "2006-01-02 15:04:05.000",
                DisableTimestamp: false,
                DisableLevel:     false,
                DisableCaller:    true,
            },
        )

        logger.Infof("日志初始化完成，日志目录: %s", logDir)
    }
    ```

    注意：不要修改 FormatterType、TimestampFormat、DisableCaller 等格式配置 - 这些由 06-01 负责配置。此任务只修改路径计算逻辑。
  </action>
  <verify>
    运行 `go build -o build/bin/ai-commit-hub.exe .` 确保编译通过
  </verify>
  <done>
    initLogger() 函数使用 os.Executable() 获取程序根目录，日志输出到 {exeDir}/logs/
  </done>
</task>

</tasks>

<verification>
1. 编译通过：`go build -o build/bin/ai-commit-hub.exe .`
2. 运行应用程序
3. 检查可执行文件所在目录下是否创建了 logs 文件夹
4. 验证日志文件是否在 logs 文件夹中生成
5. 从不同路径（快捷方式、命令行等）启动应用，验证日志位置始终一致
</verification>

<success_criteria>
- [ ] initLogger() 使用 os.Executable() 获取路径
- [ ] logDir = filepath.Join(exeDir, "logs")
- [ ] 代码编译通过
- [ ] logs 文件夹在可执行文件目录下创建
- [ ] 日志文件输出到 logs 文件夹
</success_criteria>

<output>
完成后创建 `.planning/phases/06-日志系统修复/06-02-SUMMARY.md`
</output>
