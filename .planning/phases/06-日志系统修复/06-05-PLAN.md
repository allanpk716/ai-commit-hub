---
phase: 06-日志系统修复
plan: 05
type: execute
wave: 3
depends_on: ["06-01", "06-02"]
files_modified:
  - pkg/update/downloader.go
  - pkg/update/installer.go
  - pkg/git/filecontent.go
  - pkg/repository/migration.go
  - pkg/pushover/installer.go
  - pkg/pushover/status.go
autonomous: true

must_haves:
  truths:
    - "pkg/update, pkg/git, pkg/repository, pkg/pushover 目录下所有 logger 调用使用正确的方法签名"
    - "带格式化参数的调用使用 Infof/Errorf/Warnf/Debugf"
    - "带结构化字段的调用使用 WithField/WithFields 链式调用"
  artifacts:
    - path: "pkg/update/downloader.go"
      provides: "日志方法签名修复"
    - path: "pkg/update/installer.go"
      provides: "日志方法签名修复"
    - path: "pkg/git/filecontent.go"
      provides: "日志方法签名修复"
    - path: "pkg/repository/migration.go"
      provides: "日志方法签名修复"
    - path: "pkg/pushover/installer.go"
      provides: "日志方法签名修复"
    - path: "pkg/pushover/status.go"
      provides: "日志方法签名修复"
  key_links:
    - from: "pkg/update/*.go, pkg/git/*.go, pkg/repository/*.go, pkg/pushover/*.go"
      to: "logger 方法调用"
      via: "方法签名修复"
      pattern: "logger\\.(Info|Error|Warn|Debug)f\\("
---

<objective>
修复 pkg/update、pkg/git、pkg/repository、pkg/pushover 目录中的 logger 调用方法签名错误。

目的：修复支持模块（更新、git、数据访问、推送通知）中的错误日志调用。
输出：所有支持模块中的 logger 调用使用正确的方法签名
</objective>

<execution_context>
@C:\Users\allan716\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\allan716\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-日志系统修复/06-日志系统修复-RESEARCH.md

# Prior decisions affecting this plan
- logger 调用方法签名规范：区分普通方法和格式化方法
- 不带格式化参数使用 logger.Error(msg)
- 带格式化参数使用 logger.Errorf(fmt, args...)
- 带结构化字段使用 WithField/WithFields 链式调用

# 06-01, 06-02, 06-03, 06-04 已完成
- 06-01 已配置 withField 格式器和时间戳格式
- 06-02 已配置日志输出路径到程序根目录 logs 文件夹
- 06-03 已修复 main.go 和 app.go 中的 logger 调用
- 06-04 已修复 pkg/service 目录中的 logger 调用
</context>

<tasks>

<task type="auto">
  <name>修复 pkg/update 中的 logger 方法签名错误</name>
  <files>
    pkg/update/downloader.go
    pkg/update/installer.go
  </files>
  <action>
    修复 pkg/update 目录下所有 Go 文件中的 logger 方法签名错误。

    检查文件：
    1. pkg/update/installer.go
       - 第47行：logger.Info("开始安装更新...", "zip", updateZipPath)

    修复模式：
    - 多参数键值对 -> WithField 或 WithFields
    - 单参数简单消息 -> 保持不变
    - 需要格式化 -> *f 方法
  </action>
  <verify>
    grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/update/ 确认无错误调用
  </verify>
  <done>
    pkg/update 目录下所有 logger 调用使用正确的方法签名
  </done>
</task>

<task type="auto">
  <name>修复 pkg/git 和 pkg/repository 中的 logger 方法签名错误</name>
  <files>
    pkg/git/filecontent.go
    pkg/repository/migration.go
  </files>
  <action>
    修复 pkg/git 和 pkg/repository 目录下所有 Go 文件中的 logger 方法签名错误。

    检查并修复所有类似的错误调用模式。
  </action>
  <verify>
    grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/git/ pkg/repository/ 确认无错误调用
  </verify>
  <done>
    pkg/git 和 pkg/repository 目录下所有 logger 调用使用正确的方法签名
  </done>
</task>

<task type="auto">
  <name>修复 pkg/pushover 中的 logger 方法签名错误</name>
  <files>
    pkg/pushover/installer.go
    pkg/pushover/status.go
  </files>
  <action>
    修复 pkg/pushover 目录下所有 Go 文件中的 logger 方法签名错误。

    检查并修复所有类似的错误调用模式。
  </action>
  <verify>
    grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/pushover/ 确认无错误调用
  </verify>
  <done>
    pkg/pushover 目录下所有 logger 调用使用正确的方法签名
  </done>
</task>

</tasks>

<verification>
1. 全量搜索确认无遗漏的错误调用：
   `grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/update/ pkg/git/ pkg/repository/ pkg/pushover/`

2. 编译测试：
   `go build -o build/bin/ai-commit-hub.exe .`

3. 运行应用程序，观察日志输出格式是否正常
</verification>

<success_criteria>
- [ ] 所有目标目录 grep 搜索无结果
- [ ] 代码编译通过
- [ ] 日志输出格式符合标准
- [ ] 无编译错误或警告
</success_criteria>

<output>
完成后创建 `.planning/phases/06-日志系统修复/06-05-SUMMARY.md`
</output>
