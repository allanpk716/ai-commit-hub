---
phase: 06-日志系统修复
plan: 04
type: execute
wave: 3
depends_on: ["06-01", "06-02"]
files_modified:
  - pkg/service/update_service.go
  - pkg/service/startup_service.go
  - pkg/service/error_service.go
  - pkg/service/project_config_service.go
  - pkg/service/commit_service.go
autonomous: true

must_haves:
  truths:
    - "pkg/service 目录下所有 logger 调用使用正确的方法签名"
    - "带格式化参数的调用使用 Infof/Errorf/Warnf/Debugf"
    - "带结构化字段的调用使用 WithField/WithFields 链式调用"
  artifacts:
    - path: "pkg/service/update_service.go"
      provides: "日志方法签名修复"
    - path: "pkg/service/startup_service.go"
      provides: "日志方法签名修复"
    - path: "pkg/service/error_service.go"
      provides: "日志方法签名修复"
    - path: "pkg/service/project_config_service.go"
      provides: "日志方法签名修复"
    - path: "pkg/service/commit_service.go"
      provides: "日志方法签名修复"
  key_links:
    - from: "pkg/service/*.go"
      to: "logger 方法调用"
      via: "方法签名修复"
      pattern: "logger\\.(Info|Error|Warn|Debug)f\\("
---

<objective>
修复 pkg/service 目录中的 logger 调用方法签名错误，确保业务逻辑层的日志调用符合 API 规范。

目的：修复业务逻辑层（service 层）中的错误日志调用。
输出：pkg/service 目录下所有 logger 调用使用正确的方法签名
</objective>

<execution_context>
@C:\Users\allan716\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\allan716\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-日志系统修复/06-日志系统修复-RESEARCH.md

# Prior decisions affecting this plan
- logger 调用方法签名规范：区分普通方法和格式化方法
- 不带格式化参数使用 logger.Error(msg)
- 带格式化参数使用 logger.Errorf(fmt, args...)
- 带结构化字段使用 WithField/WithFields 链式调用

# 06-01, 06-02, 06-03 已完成
- 06-01 已配置 withField 格式器和时间戳格式
- 06-02 已配置日志输出路径到程序根目录 logs 文件夹
- 06-03 已修复 main.go 和 app.go 中的 logger 调用
</context>

<tasks>

<task type="auto">
  <name>修复 pkg/service 中的 logger 方法签名错误</name>
  <files>
    pkg/service/update_service.go
    pkg/service/startup_service.go
    pkg/service/error_service.go
    pkg/service/project_config_service.go
    pkg/service/commit_service.go
  </files>
  <action>
    修复 pkg/service 目录下所有 Go 文件中的 logger 方法签名错误。

    检查文件：
    1. pkg/service/update_service.go
       - 第70行：logger.Info("检查更新", "repo", s.repo)
       - 第107行：logger.Info("版本信息", "current", currentVersion, "latest", latestVersion)

    2. 其他 service 文件中的类似问题

    修复模式：
    - 多参数键值对 -> WithField 或 WithFields
    - 单参数简单消息 -> 保持不变
    - 需要格式化 -> *f 方法

    示例：
    ```go
    // 错误：
    logger.Info("检查更新", "repo", s.repo)
    // 修复为：
    logger.WithField("repo", s.repo).Info("检查更新")

    // 错误：
    logger.Info("版本信息", "current", currentVersion, "latest", latestVersion)
    // 修复为：
    logger.WithFields(map[string]interface{}{
        "current": currentVersion,
        "latest": latestVersion,
    }).Info("版本信息")
    ```
  </action>
  <verify>
    grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/service/ 确认无错误调用
  </verify>
  <done>
    pkg/service 目录下所有 logger 调用使用正确的方法签名
  </done>
</task>

</tasks>

<verification>
1. 搜索 pkg/service 目录确认无错误调用：
   `grep -rn 'logger\.\(Info\|Error\|Warn\|Debug\)([^,)]*,[^)]*)' pkg/service/`

2. 编译测试：
   `go build -o build/bin/ai-commit-hub.exe .`

3. 运行应用程序，观察业务逻辑日志输出格式是否正常
</verification>

<success_criteria>
- [ ] pkg/service 目录 grep 搜索无结果
- [ ] 代码编译通过
- [ ] 日志输出格式符合标准
- [ ] 无编译错误或警告
</success_criteria>

<output>
完成后创建 `.planning/phases/06-日志系统修复/06-04-SUMMARY.md`
</output>
