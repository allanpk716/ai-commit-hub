# Phase 6: 日志系统修复 - Context

**Gathered:** 2026-02-08
**Status:** Ready for planning

## Phase Boundary

修复日志格式和输出路径问题，确保日志正确输出到程序根目录 logs 文件夹。修复所有 logger 调用的方法签名错误。不涉及新功能开发，仅修复现有基础设施问题。

## Implementation Decisions

### 日志格式配置
- 使用 withField 格式器，包含字段：时间戳 + 日志级别 + 模块名 + 消息
- 时间戳精度：毫秒级（YYYY-MM-DD HH:MM:SS.mmm）
- 模块标识：使用时通过链式调用 `.WithField("module", "模块名")` 指定
- 日志级别显示：仅显示级别代码，如 `[INFO]`, `[ERROR]`（不显示完整文本）
- 错误日志格式：与普通日志统一格式，无特殊高亮
- 支持结构化字段：除模块字段外，支持添加其他动态字段（如 requestID、userID）
- 输出格式统一：文件和控制台使用相同格式

### 输出路径设置
- 程序根目录确定：始终使用可执行文件（.exe）所在目录
- 日志文件夹路径：`{exeDir}/logs/`（相对路径）
- 文件夹不存在时：自动创建 logs 目录
- 日志文件命名：按日期分文件，格式为 `YYYY-MM-DD.log`（仅日期，无前缀）

### 日志轮转策略
- 时间轮转：每天午夜创建新日志文件
- 大小轮转阈值：单个日志文件达到 10 MB 时进行轮转
- 轮转文件命名：使用递增序号后缀，如 `2025-12-18.001.log`, `2025-12-18.002.log`
- 日志清理策略：删除 30 天前的日志，但至少保留最近 7 个文件

### 修复优先级
- 修复顺序：先修复格式配置和路径配置，最后修复 logger 调用方法签名（避免重复修复）
- logger 调用修复策略：按功能优先级分批修复（核心功能 → 辅助功能 → 边缘功能）
- 问题识别方法：双重验证 - 静态代码分析（grep/go list）+ 依赖测试失败
- 计划拆分策略：按问题拆分为 3 个独立 plan
  - Plan 06-01: 修复日志格式配置
  - Plan 06-02: 配置日志输出路径
  - Plan 06-03: 修复所有 logger 调用方法签名
- 测试策略：每个 plan 包含独立的单元测试，验证修复正确性

### Claude's Discretion
- withField 格式器的具体配置代码实现
- 模块名字段的标准化命名规范（如使用中文还是英文）
- 日志轮转的具体实现方式（使用 WQGroup/logger 内置功能或自定义）
- 30 天清理的具体执行时机（启动时检查 vs 定时任务）

## Specific Ideas

无特定参考 - 采用 WQGroup/logger 库的标准实践

## Deferred Ideas

无 - 讨论严格限制在 Phase 6 范围内

---

*Phase: 06-日志系统修复*
*Context gathered: 2026-02-08*
