---
phase: 01-ci-cd-pipeline
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - .github/workflows/build.yml
autonomous: true

must_haves:
  truths:
    - Build artifacts are automatically published to GitHub Releases
    - Pre-release versions are marked as pre-release in GitHub
    - Release includes ZIP package and both checksum files
    - Release notes are auto-generated from commit messages
  artifacts:
    - path: .github/workflows/build.yml
      provides: Complete CI/CD workflow with release publishing
      contains: release job with softprops/action-gh-release
  key_links:
    - from: .github/workflows/build.yml (release job)
      to: GitHub Releases
      via: softprops/action-gh-release@v1
      pattern: softprops/action-gh-release
    - from: .github/workflows/build.yml (prerelease detection)
      to: GitHub Release pre-release flag
      via: prerelease output variable
      pattern: prerelease.*outputs
---

<objective>
Configure automatic GitHub Release creation with build artifacts, pre-release detection, and release notes.

Purpose: Complete the CI/CD pipeline by automatically publishing builds to GitHub Releases when version tags are pushed, eliminating manual release steps.

Output: Complete workflow that builds, packages, and publishes releases automatically.
</objective>

<execution_context>
@C:\Users\allan716\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\allan716\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-ci-cd-pipeline/01-CONTEXT.md
@.planning/phases/01-ci-cd-pipeline/01-RESEARCH.md

@.github/workflows/release.yml
@.planning/phases/01-ci-cd-pipeline/01-01-SUMMARY.md
@.planning/phases/01-ci-cd-pipeline/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add separate release job to workflow</name>
  <files>.github/workflows/build.yml</files>
  <action>
Add a second job called "release" to the workflow.

Job configuration:
1. needs: build (waits for build job to complete)
2. runs-on: ubuntu-latest (cheaper for release-only job)
3. timeout-minutes: 10

This separates build concerns (Windows) from release concerns (can run anywhere).
  </action>
  <verify>
Workflow has second job named "release" with:
- needs: build dependency
- runs-on: ubuntu-latest
- timeout-minutes: 10
  </verify>
  <done>
Release job runs after successful build
  </done>
</task>

<task type="auto">
  <name>Download artifacts in release job</name>
  <files>.github/workflows/build.yml</files>
  <action>
Add step to download all artifacts from build job.

Use actions/download-artifact@v4 with:
- path: artifacts

This retrieves all uploaded .zip, .sha256, .md5 files from the build job.
  </action>
  <verify>
Release job contains download-artifact step with path: artifacts
  </verify>
  <done>
Artifacts from build job are available for release upload
  </done>
</task>

<task type="auto">
  <name>Configure GitHub Release creation</name>
  <files>.github/workflows/build.yml</files>
  <action>
Add "Create Release" step using softprops/action-gh-release@v1.

Configuration:
1. files pattern:
   ```
   artifacts/**/*.zip
   artifacts/**/*.sha256
   artifacts/**/*.md5
   ```

2. name: v${{ needs.build.outputs.VERSION }}
   (Note: need to add outputs to build job first)

3. generate_release_notes: true
   (Auto-generates release notes from commits since last release)

4. draft: false
   (Directly publish releases for stable versions)

5. prerelease: ${{ needs.build.outputs.PRERELEASE }}
   (Uses pre-release detection from build job)

6. env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   (Automatic token provided by GitHub Actions)

IMPORTANT: First add outputs to build job:
```
jobs:
  build:
    # ... existing config ...
    outputs:
      VERSION: ${{ steps.meta.outputs.VERSION }}
      PRERELEASE: ${{ steps.meta.outputs.PRERELEASE }}
```

The prerelease detection in build job should use regex:
```bash
if [[ "$VERSION" =~ -(alpha|beta|rc|pre)\.?[0-9]*$ ]]; then
  echo "prerelease=true" >> $GITHUB_OUTPUT
else
  echo "prerelease=false" >> $GITHUB_OUTPUT
fi
```
  </action>
  <verify>
Release job contains softprops/action-gh-release@v1 step with:
- files: artifacts/**/*.zip, artifacts/**/*.sha256, artifacts/**/*.md5
- generate_release_notes: true
- prerelease: from build job output
- GITHUB_TOKEN configured
- Build job has outputs: VERSION, PRERELEASE
  </verify>
  <done>
Releases are created with all artifacts and correct pre-release flag
  </done>
</task>

<task type="auto">
  <name>Update or remove old release.yml</name>
  <files>.github/workflows/release.yml</files>
  <action>
Delete the old .github/workflows/release.yml file since its functionality is now merged into build.yml.

The old workflow:
- Has incorrect ldflags path (main.version instead of pkg/version)
- Missing checksums
- Incorrect package naming
- No pre-release detection

All its functionality is now in the enhanced build.yml.

Use: Remove the file completely.
  </action>
  <verify>
.github/workflows/release.yml no longer exists
  </verify>
  <done>
Only one workflow file (build.yml) remains for CI/CD
  </done>
</task>

</tasks>

<verification>
After configuring release job, verify:

1. Release job depends on build job (needs: build)
2. Build job exports VERSION and PRERELEASE outputs
3. Release job downloads artifacts from build job
4. Release job uses softprops/action-gh-release@v1
5. All three file types (.zip, .sha256, .md5) are uploaded
6. Release notes are auto-generated
7. Pre-release flag is set based on version tag
8. Old release.yml is removed
</verification>

<success_criteria>
1. .github/workflows/build.yml is the sole CI/CD workflow
2. Workflow has two jobs: build (Windows) and release (Ubuntu)
3. Build job outputs VERSION and PRERELEASE
4. Release job creates GitHub Release with all artifacts
5. Pre-release versions are correctly marked
6. Release notes are auto-generated
7. Pushing a version tag triggers full build-and-release pipeline
</success_criteria>

<output>
After completion, create `.planning/phases/01-ci-cd-pipeline/01-03-SUMMARY.md` with:
- Complete workflow structure
- Trigger behavior explanation
- Release artifact contents
- Version tagging conventions
</output>
