# æœªè·Ÿè¸ªæ–‡ä»¶ç®¡ç†å’Œæ’é™¤åŠŸèƒ½è®¾è®¡

**æ—¥æœŸ**: 2026-01-27
**çŠ¶æ€**: è®¾è®¡å®Œæˆï¼Œå¾…å®ç°

## æ¦‚è¿°

ä¸º AI Commit Hub æ·»åŠ æœªè·Ÿè¸ªæ–‡ä»¶æ˜¾ç¤ºå’Œç®¡ç†åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹æœªè·Ÿè¸ªä½†æœªè¢« `.gitignore` æ’é™¤çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å³é”®èœå•è¿›è¡Œæ“ä½œï¼šæ·»åŠ åˆ°æš‚å­˜åŒºã€æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨ã€æ‰“å¼€ä½ç½®ã€å¤åˆ¶è·¯å¾„ã€‚

## åŠŸèƒ½éœ€æ±‚

### 1. æ˜¾ç¤ºæœªè·Ÿè¸ªæ–‡ä»¶

åœ¨æš‚å­˜åŒºä¸‹æ–¹æ–°å¢"æœªè·Ÿè¸ªæ–‡ä»¶"åŒºåŸŸï¼Œæ˜¾ç¤ºæ‰€æœ‰æœªè·Ÿè¸ªä¸”æœªè¢« `.gitignore` æ’é™¤çš„æ–‡ä»¶ï¼ˆæ–°å¢æ–‡ä»¶ï¼‰ã€‚

### 2. å³é”®èœå•æ“ä½œ

- **å¤åˆ¶æ–‡ä»¶è·¯å¾„**: å¤åˆ¶æ–‡ä»¶ç›¸å¯¹è·¯å¾„åˆ°å‰ªè´´æ¿
- **æ·»åŠ åˆ°æš‚å­˜åŒº**: æ‰§è¡Œ `git add` å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº
- **æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨**: å¼¹å‡ºå¯¹è¯æ¡†é€‰æ‹©æ’é™¤æ–¹å¼
- **åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€**: æ‰“å¼€æ–‡ä»¶æ‰€åœ¨ç›®å½•

### 3. æ’é™¤å¯¹è¯æ¡†

æä¾›ä¸‰ç§æ’é™¤æ¨¡å¼ï¼š

1. **ç²¾ç¡®æ–‡ä»¶å**: å¿½ç•¥å®Œå…¨åŒ¹é…çš„æ–‡ä»¶è·¯å¾„
   - ç¤ºä¾‹: `docs/plans/design.md`

2. **æ‰©å±•å**: å¿½ç•¥æ‰€æœ‰ç›¸åŒæ‰©å±•åçš„æ–‡ä»¶
   - ç¤ºä¾‹: `*.md`

3. **ç›®å½•**: å¿½ç•¥æŒ‡å®šç›®å½•ï¼Œæ”¯æŒå¤šå±‚é€‰æ‹©
   - ç¬¬ä¸€å±‚: `docs`
   - ç¬¬äºŒå±‚: `docs/plans`
   - ç›®å½•ä¸‹æ‰€æœ‰æ‰©å±•å: `docs/plans/*.md`

### 4. è§„åˆ™å­˜å‚¨

æ’é™¤è§„åˆ™ä¿å­˜åˆ°é¡¹ç›®çš„ `.gitignore` æ–‡ä»¶ï¼Œä½¿ç”¨ Git æ ‡å‡†è·¯å¾„æ ¼å¼ï¼ˆ`/` åˆ†éš”ç¬¦ï¼‰ã€‚

## UI è®¾è®¡

### æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æš‚å­˜åŒº                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [å·²æš‚å­˜çš„æ–‡ä»¶åˆ—è¡¨]           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœªè·Ÿè¸ªæ–‡ä»¶ (3)         [â–¼ æŠ˜å ]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ utils.ts                    â”‚   â”‚
â”‚  â”‚ config.json                 â”‚   â”‚
â”‚  â”‚ README.md                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å³é”®èœå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ å¤åˆ¶æ–‡ä»¶è·¯å¾„              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ æ·»åŠ åˆ°æš‚å­˜åŒº              â”‚
â”‚  ğŸš« æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨...         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’é™¤å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨             [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  å¿½ç•¥æ–‡ä»¶åæˆ–æ¨¡å¼:                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ docs/plans/design.md        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â—‹ å¿½ç•¥ç²¾ç¡®çš„æ–‡ä»¶å                  â”‚
â”‚                                     â”‚
â”‚  â—‹ å¿½ç•¥æ‰€æœ‰æ–‡ä»¶çš„æ‰©å±•å (.md)        â”‚
â”‚                                     â”‚
â”‚  â— å¿½ç•¥ä¸‹åˆ—æ‰€æœ‰:                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚ docs                â”‚         â”‚
â”‚     â”‚ docs/plans          â”‚         â”‚
â”‚     â”‚ docs/plans/*.md     â”‚         â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                     â”‚
â”‚     [å–æ¶ˆ]  [ç¡®å®š]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åç«¯ API è®¾è®¡

### 1. è·å–æœªè·Ÿè¸ªæ–‡ä»¶

```go
func (a *App) GetUntrackedFiles(projectPath string) ([]UntrackedFile, error)
```

- æ‰§è¡Œ `git ls-files --others --exclude-standard`
- è¿”å›æœªè·Ÿè¸ªä½†æœªè¢« `.gitignore` æ’é™¤çš„æ–‡ä»¶åˆ—è¡¨
- **å¿…é¡»ä½¿ç”¨** `Command()` å‡½æ•°é¿å… Windows æ§åˆ¶å°å¼¹çª—

### 2. æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº

```go
func (a *App) StageFiles(projectPath string, files []string) error
```

- æ‰§è¡Œ `git add <files>`
- æ”¯æŒæ‰¹é‡æ·»åŠ 

### 3. æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨

```go
func (a *App) AddToGitIgnore(projectPath, pattern, mode string) error
```

- `mode`: "exact" | "extension" | "directory"
- æ ¹æ®æ¨¡å¼ç”Ÿæˆå¯¹åº”çš„ `.gitignore` è§„åˆ™
- è¿½åŠ åˆ° `.gitignore` æ–‡ä»¶ï¼Œä¸è¦†ç›–ç°æœ‰è§„åˆ™
- è‡ªåŠ¨å¤„ç†è·¯å¾„åˆ†éš”ç¬¦ï¼ˆWindows `\` â†’ `/`ï¼‰

## å‰ç«¯ç»„ä»¶è®¾è®¡

### æ–°å»ºç»„ä»¶

1. **UntrackedFiles.vue**: æœªè·Ÿè¸ªæ–‡ä»¶åˆ—è¡¨ç»„ä»¶
2. **ContextMenu.vue**: å³é”®èœå•ç»„ä»¶
3. **ExcludeDialog.vue**: æ’é™¤å¯¹è¯æ¡†ç»„ä»¶

### æ‰©å±•çŠ¶æ€ç®¡ç†

åœ¨ `commitStore.ts` æ·»åŠ ï¼š

```typescript
interface UntrackedFile {
  path: string
  displayName: string
}

// æ–°å¢çŠ¶æ€
untrackedFiles: UntrackedFile[]
untrackedFilesLoading: boolean

// æ–°å¢æ–¹æ³•
async loadUntrackedFiles(projectPath: string)
async stageFiles(files: string[])
async addToGitIgnore(file: string, mode: ExcludeMode)
```

### æ•°æ®æµ

```
ç”¨æˆ·é€‰æ‹©é¡¹ç›®
    â†“
loadProjectStatus() + loadUntrackedFiles()
    â†“
æ˜¾ç¤ºæš‚å­˜åŒºæ–‡ä»¶ + æœªè·Ÿè¸ªæ–‡ä»¶
    â†“
ç”¨æˆ·å³é”®ç‚¹å‡»æœªè·Ÿè¸ªæ–‡ä»¶
    â†“
è§¦å‘æ“ä½œï¼ˆæš‚å­˜/æ’é™¤/æ‰“å¼€/å¤åˆ¶ï¼‰
    â†“
è°ƒç”¨åç«¯ API
    â†“
åˆ·æ–°ä¸¤ä¸ªåŒºåŸŸçš„çŠ¶æ€
```

## æŠ€æœ¯å®ç°è¦ç‚¹

### 1. é¿å…æ§åˆ¶å°å¼¹çª—

æ‰€æœ‰ Git å‘½ä»¤å¿…é¡»ä½¿ç”¨ç°æœ‰çš„ `Command()` å‡½æ•°ï¼ˆ`pkg/git/cmdhelper.go`ï¼‰ï¼Œè¯¥å‡½æ•°å·²åœ¨ Windows ä¸Šè®¾ç½® `CREATE_NO_WINDOW` æ ‡å¿—ã€‚

### 2. Git æ ‡å‡†è·¯å¾„æ ¼å¼

```go
func toGitPath(path string) string {
    return strings.ReplaceAll(path, "\\", "/")
}
```

### 3. ç›®å½•å±‚çº§åˆ†æ

```go
func getDirectoryOptions(filePath string) []DirectoryOption {
    parts := strings.Split(toGitPath(filePath), "/")
    var options []DirectoryOption

    var pathBuilder strings.Builder
    for i := 0; i < len(parts)-1; i++ {
        if i > 0 {
            pathBuilder.WriteString("/")
        }
        pathBuilder.WriteString(parts[i])

        options = append(options, DirectoryOption{
            Pattern: pathBuilder.String(),  // docs, docs/plans
        })
    }

    // æ·»åŠ "ç›®å½•ä¸‹æ‰€æœ‰æ‰©å±•å"é€‰é¡¹
    if len(parts) > 1 {
        dir := pathBuilder.String()
        ext := filepath.Ext(filePath)
        options = append(options, DirectoryOption{
            Pattern: dir + "/*" + ext,  // docs/plans/*.md
        })
    }

    return options
}
```

### 4. å†™å…¥ .gitignore

```go
func addToGitIgnoreFile(projectPath, pattern string) error {
    gitIgnorePath := filepath.Join(projectPath, ".gitignore")

    // è¯»å–ç°æœ‰å†…å®¹
    var content []string
    if data, err := os.ReadFile(gitIgnorePath); err == nil {
        content = strings.Split(string(data), "\n")
    }

    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    for _, line := range content {
        if strings.TrimSpace(line) == pattern {
            return nil // å·²å­˜åœ¨
        }
    }

    // è¿½åŠ æ–°è§„åˆ™
    content = append(content, pattern, "")
    return os.WriteFile(gitIgnorePath, []byte(strings.Join(content, "\n")), 0644)
}
```

## è¾¹ç•Œæƒ…å†µå¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| æ— æœªè·Ÿè¸ªæ–‡ä»¶ | æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º |
| é¡¹ç›®ä¸æ˜¯ Git ä»“åº“ | æ˜¾ç¤ºé”™è¯¯æç¤º |
| .gitignore ä¸å­˜åœ¨ | åˆ›å»ºæ–°æ–‡ä»¶ |
| å¤šæ–‡ä»¶é€‰æ‹©æ’é™¤ | ç¦ç”¨"ç›®å½•"é€‰é¡¹ |
| è·¯å¾„åŒ…å«ä¸­æ–‡ | æ­£ç¡®å¤„ç† UTF-8 |
| Windows è·¯å¾„ | è‡ªåŠ¨è½¬æ¢ä¸º `/` |

## å®ç°æ­¥éª¤

### é˜¶æ®µ 1ï¼šåç«¯å®ç°

1. `pkg/git/status.go`: æ·»åŠ  `GetUntrackedFiles()`
2. `pkg/git/gitignore.go`: æ–°å»ºæ–‡ä»¶ï¼Œå®ç°æ’é™¤é€»è¾‘
3. `app.go`: æ·»åŠ å¯¼å‡ºçš„ API æ–¹æ³•

### é˜¶æ®µ 2ï¼šå‰ç«¯å®ç°

1. åˆ›å»º `UntrackedFiles.vue`, `ContextMenu.vue`, `ExcludeDialog.vue`
2. æ‰©å±• `commitStore.ts`
3. ä¿®æ”¹ `StagingArea.vue` é›†æˆæ–°ç»„ä»¶

### é˜¶æ®µ 3ï¼šæµ‹è¯•

1. æµ‹è¯•å„ç§æ–‡ä»¶è·¯å¾„æ ¼å¼
2. æµ‹è¯•å¤šå±‚çº§ç›®å½•æ’é™¤
3. æµ‹è¯• Windows è·¯å¾„å¤„ç†
4. æµ‹è¯•é”™è¯¯åœºæ™¯

## è®¾è®¡å†³ç­–

### Q1: ä¸ºä»€ä¹ˆä½¿ç”¨å³é”®èœå•è€Œä¸æ˜¯ç›´æ¥æ˜¾ç¤ºæ“ä½œæŒ‰é’®ï¼Ÿ

**A**: å³é”®èœå•æ›´ç®€æ´ï¼Œç¬¦åˆæ–‡ä»¶ç®¡ç†å™¨çš„æ“ä½œä¹ æƒ¯ï¼Œä¹Ÿä¾¿äºæœªæ¥æ‰©å±•æ›´å¤šæ“ä½œã€‚

### Q2: ä¸ºä»€ä¹ˆæ’é™¤è§„åˆ™ä¿å­˜åœ¨ .gitignore è€Œä¸æ˜¯åº”ç”¨æ•°æ®åº“ï¼Ÿ

**A**: .gitignore æ˜¯ Git æ ‡å‡†ï¼Œä¸å…¶ä»– Git å·¥å…·å…¼å®¹ï¼Œè§„åˆ™åœ¨ä»“åº“ä¸­å…±äº«ã€‚

### Q3: ä¸ºä»€ä¹ˆç›®å½•æ¨¡å¼éœ€è¦æ”¯æŒå¤šå±‚é€‰æ‹©ï¼Ÿ

**A**: ä¸åŒåœºæ™¯ä¸‹ç”¨æˆ·å¯èƒ½éœ€è¦æ’é™¤ä¸åŒç²’åº¦çš„å†…å®¹ï¼Œçµæ´»é€‰æ‹©æ›´å®ç”¨ã€‚
