# UI 改进设计方案

**日期**: 2025-01-26
**作者**: Claude Code
**状态**: 设计完成

---

## 概述

本文档描述 AI Commit Hub 应用的四项 UI 改进设计，旨在提升用户体验和空间利用率。

---

## 改进点

### 1. 打开项目文件夹功能

在当前状态区域添加打开项目文件夹的操作按钮。

#### 功能需求

- 支持在系统文件管理器中打开项目路径
- 支持在终端中打开项目路径
- 跨平台支持（Windows/macOS/Linux）
- 记住用户偏好的终端类型

#### UI 设计

按钮位于当前状态区域标题栏右侧，与分支 badge 并排显示。

```
┌─────────────────────────────────────────────┐
│ 当前状态                    ⑂ main  📁  🔄  │
├─────────────────────────────────────────────┤
│ [暂存区为空提示]                            │
│ 或暂存文件列表                               │
└─────────────────────────────────────────────┘
```

点击 📁 按钮显示下拉菜单：

**Windows**:
- 在文件管理器中打开
- 在终端中打开
  - PowerShell
  - 命令提示符
  - Windows Terminal

**macOS**:
- 在文件管理器中打开
- 在终端中打开
  - Terminal
  - iTerm2

**Linux**:
- 在文件管理器中打开
- 在终端中打开
  - 默认终端

用户选择的终端类型保存到 `localStorage`，下次自动选中。

---

### 2. 手动刷新功能

在当前状态区域添加手动刷新按钮，避免切换项目来触发刷新。

#### 功能需求

- 点击刷新按钮重新加载项目状态
- 显示加载状态

#### UI 设计

刷新按钮与打开文件夹按钮并排显示，使用 🔄 图标。

---

### 3. 暂存区为空提示优化

减少空状态占用的空间，提升空间利用率。

#### 当前问题

暂存区为空时，提示居中显示整个容器，占用约 200px 高度。

#### 优化方案

在暂存区容器顶部显示一行小字提示。

```
┌─────────────────────────────────────┐
│ ℹ️ 暂存区为空，请先使用 git add 添加文件│
│                                     │
│ [后续有文件时才显示列表]             │
└─────────────────────────────────────┘
```

样式：灰色小字（12px），padding 8px，淡灰色背景。

将占用空间从 ~200px 减少到 ~30px。

---

### 4. 等待生成提示优化

与暂存区提示类似，减少空状态占用的空间。

#### 当前问题

等待生成时，提示居中显示整个消息容器，占用约 250px 高度。

#### 优化方案

在消息容器顶部显示一行小字提示。

```
┌─────────────────────────────────────┐
│ ⏳ 等待生成... 配置 AI 设置后点击生成│
│                                     │
│ [生成后显示内容]                     │
└─────────────────────────────────────┘
```

样式与暂存区提示一致。生成内容后自动隐藏。

---

## 技术实现

### 后端 API

#### 新增 Go 方法

**OpenInFileExplorer**
```go
func (a *App) OpenInFileExplorer(projectPath string) error
```
在系统文件管理器中打开项目路径。

**OpenInTerminal**
```go
func (a *App) OpenInTerminal(projectPath, terminalType string) error
```
在指定终端中打开项目路径。

**GetAvailableTerminals**
```go
func (a *App) GetAvailableTerminals() []Terminal
```
返回当前平台可用的终端列表。

#### 平台检测

使用 `stdruntime.GOOS` 检测操作系统：

- **Windows**: `explorer`、`powershell`、`cmd`、`wt`
- **macOS**: `open`、`Terminal`、`iTerm2`
- **Linux**: `xdg-open`、`xdg-terminal`

### 前端实现

#### 组件修改

修改 `CommitPanel.vue`：

1. 在 `section-header` 添加操作按钮组
2. 添加下拉菜单组件
3. 修改空状态提示样式

#### 用户偏好存储

使用 `localStorage` 存储用户偏好的终端类型：

```typescript
const PREFERRED_TERMINAL_KEY = 'ai-commit-hub:preferred-terminal'
```

#### 样式调整

新增样式：

- `.action-buttons-inline`: 操作按钮组
- `.dropdown-menu`: 下拉菜单
- `.empty-hint-inline`: 内联空提示
- `.message-hint-inline`: 内联消息提示

---

## 数据流

### 打开项目文件夹流程

```
用户点击 📁 按钮
  ↓
显示下拉菜单（加载可用终端列表）
  ↓
用户选择选项
  ↓
调用后端 API
  ↓
成功：关闭菜单，显示成功提示
失败：显示错误提示
```

### 刷新项目状态流程

```
用户点击 🔄 按钮
  ↓
调用 commitStore.loadProjectStatus(projectPath)
  ↓
重新获取暂存区状态
  ↓
UI 自动更新
```

---

## 错误处理

### 文件/终端打开失败

- **路径不存在**: 显示"项目路径不存在"
- **权限不足**: 显示"没有访问权限"
- **终端未安装**: 显示"终端未安装，请先安装"
- **其他错误**: 显示具体错误信息

### 刷新失败

- **Git 仓库无效**: 显示"不是有效的 Git 仓库"
- **网络问题**: 显示"检查远程仓库失败"

---

## 测试计划

### 功能测试

- [ ] Windows: 文件管理器打开
- [ ] Windows: PowerShell 打开
- [ ] Windows: CMD 打开
- [ ] Windows: Windows Terminal 打开
- [ ] macOS: Finder 打开
- [ ] macOS: Terminal 打开
- [ ] Linux: 文件管理器打开
- [ ] Linux: 默认终端打开
- [ ] 刷新功能
- [ ] 用户偏好保存

### UI 测试

- [ ] 下拉菜单显示正确
- [ ] 空状态提示紧凑显示
- [ ] 响应式布局
- [ ] 点击外部关闭菜单

---

## 总结

本设计方案通过四个改进点提升用户体验：

1. **打开项目文件夹**: 跨平台支持，记住用户偏好
2. **手动刷新**: 避免切换项目来触发刷新
3. **暂存区提示优化**: 空间占用减少 85%
4. **等待生成提示优化**: 空间占用减少 85%

**关键改进**:

- 跨平台支持
- 用户体验优化（记住偏好）
- 空间利用率提升
- 完善的错误处理
