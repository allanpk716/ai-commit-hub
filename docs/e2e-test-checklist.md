# 端到端测试检查清单

## 测试信息

- **测试时间**: 2026-02-02
- **当前版本**: dev-uncommitted
- **目标版本**: v0.1.0
- **测试环境**: Windows
- **GitHub Actions**: https://github.com/allanpk716/ai-commit-hub/actions
- **Release 页面**: https://github.com/allanpk716/ai-commit-hub/releases

---

## 📋 测试前准备

### 1. 确认 GitHub Actions 构建完成

- [ ] 访问 https://github.com/allanpk716/ai-commit-hub/actions
- [ ] 确认工作流状态为 ✅ 绿色（成功）
- [ ] 等待时间：约 5-10 分钟

### 2. 确认 Release 创建成功

- [ ] 访问 https://github.com/allanpk716/ai-commit-hub/releases
- [ ] 确认看到 v0.1.0 release
- [ ] 确认包含以下资源：
  - [ ] ai-commit-hub-windows.zip（Windows 版本）
  - [ ] ai-commit-hub-macos.zip（macOS 版本）

### 3. 确认当前运行的是 dev 版本

- [ ] 程序正在运行
- [ ] 版本号显示：dev-uncommitted
- [ ] 日志显示：`AI Commit Hub starting up...versiondev-uncommitted`

---

## 🧪 端到端测试步骤

### 阶段 1：更新检测测试

**测试目标**：验证应用能正确检测到新版本

#### 步骤 1.1：启动时自动检查
- [ ] 启动应用（或重启已运行的应用）
- [ ] 观察日志输出：
  ```
  检查更新失败 / 发现新版本 version v0.1.0
  ```
- [ ] 验证：如果检测到新版本，应该看到更新通知栏

#### 步骤 1.2：手动检查更新
- [ ] 打开设置菜单（如果提供了手动检查选项）
- [ ] 点击"检查更新"按钮
- [ ] 验证：收到 update-available 事件

#### 步骤 1.3：验证更新通知显示
- [ ] 顶部应该出现内联通知栏
- [ ] 通知栏内容：
  - [ ] 显示"发现新版本 v0.1.0"
  - [ ] "查看详情"按钮
  - [ ] "忽略"按钮
- [ ] 通知栏样式：渐变背景（紫色到粉色）

**预期结果**：✅ 应用成功检测到 v0.1.0 新版本，显示更新通知

---

### 阶段 2：更新对话框测试

**测试目标**：验证更新详情对话框正确显示

#### 步骤 2.1：打开更新对话框
- [ ] 点击通知栏的"查看详情"按钮
- [ ] 验证：弹出模态对话框

#### 步骤 2.2：验证版本对比显示
- [ ] 对话框标题："发现新版本"
- [ ] 版本对比区域：
  - [ ] 当前版本: dev-uncommitted
  - [ ] 最新版本: v0.1.0（高亮显示）
  - [ ] 背景色：浅灰色

#### 步骤 2.3：验证发布说明显示
- [ ] 标题："更新内容"
- [ ] Markdown 内容正确渲染：
  - [ ] 标题（H1, H2, H3）正确显示
  - [ ] 列表（项目符号）正确显示
  - [ ] 代码块正确格式化
- [ ] 最大高度：300px，可滚动

#### 步骤 2.4：验证文件大小显示
- [ ] 显示："文件大小: XX MB"
- [ ] 大小与实际 zip 文件一致

#### 步骤 2.5：验证操作按钮
- [ ] "立即更新"按钮（紫色渐变，主要操作）
- [ ] "跳过此版本"按钮（白色，次要操作）
- [ ] "稍后提醒"按钮（白色，取消操作）

**预期结果**：✅ 对话框正确显示所有更新信息

---

### 阶段 3：下载测试

**测试目标**：验证更新包下载功能

#### 步骤 3.1：开始下载
- [ ] 点击"立即更新"按钮
- [ ] 验证：按钮变为"下载中..."并禁用

#### 步骤 3.2：观察下载进度
- [ ] 打开浏览器开发者工具（Console）
- [ ] 监听 download-progress 事件
- [ ] 验证事件数据：
  ```json
  {
    "downloaded": 字节数,
    "total": 总字节数,
    "percentage": 百分比
  }
  ```

#### 步骤 3.3：验证进度显示（如果实现了进度对话框）
- [ ] 进度条从 0% 增长到 100%
- [ ] 显示已下载/总大小
- [ ] 显示下载速度（如果实现）

#### 步骤 3.4：验证下载完成
- [ ] 监听到 download-complete 事件
- [ ] 验证临时文件：
  ```bash
  # 位置: C:\Users\<username>\AppData\Local\Temp\ai-commit-hub-update\
  # 文件: ai-commit-hub-windows.zip
  ```
- [ ] 文件大小与 Release 页面一致

**预期结果**：✅ 更新包成功下载到临时目录

---

### 阶段 4：安装测试

**测试目标**：验证更新器程序正确执行

#### 步骤 4.1：验证更新器启动
- [ ] 观察日志输出：
  ```
  开始安装更新... zip=...
  启动更新器: ...
  更新器已启动，主程序即将退出
  ```
- [ ] 验证：主程序窗口关闭

#### 步骤 4.2：等待更新器执行
- [ ] 等待约 10-30 秒
- [ ] 验证：出现新程序窗口

#### 步骤 4.3：验证文件替换
- [ ] 检查可执行文件时间戳：
  ```bash
  ls -lh build/bin/ai-commit-hub.exe
  ```
- [ ] 时间戳应该是最新的

#### 步骤 4.4：验证备份创建
- [ ] 检查备份目录：
  ```bash
  ls -lh build/bin/.backup/
  ```
- [ ] 应该存在旧版本的备份文件

**预期结果**：✅ 更新器成功替换文件并启动新版本

---

### 阶段 5：新版本验证

**测试目标**：验证新版本正确运行

#### 步骤 5.1：验证版本号
- [ ] 查看日志输出：
  ```
  AI Commit Hub starting up...version=v0.1.0
  ```
- [ ] 版本号应该显示：`v0.1.0`（而不是 dev-uncommitted）

#### 步骤 5.2：验证更新检测
- [ ] 启动时检查更新
- [ ] 应该显示："已是最新版本"
- [ ] 不应该显示更新通知

#### 步骤 5.3：功能验证
- [ ] 应用所有功能正常工作
- [ ] 项目列表正常显示
- [ ] Commit 生成功能正常
- [ ] Pushover 功能正常

**预期结果**：✅ 新版本 v0.1.0 成功运行，所有功能正常

---

## ❌ 错误处理测试

### 测试场景 1：网络中断

**测试步骤**：
1. 断开网络连接
2. 点击"立即更新"
3. 观察错误提示

**预期结果**：
- [ ] 显示友好的错误消息
- [ ] 不导致应用崩溃
- [ ] 可以重试下载

---

### 测试场景 2：磁盘空间不足

**测试步骤**：
1. 占满磁盘空间（或模拟）
2. 尝试下载更新

**预期结果**：
- [ ] 显示磁盘空间不足错误
- [ ] 提示用户清理空间
- [ ] 不损坏现有文件

---

### 测试场景 3：权限错误

**测试步骤**：
1. 设置只读权限（如果可能）
2. 尝试安装更新

**预期结果**：
- [ ] 显示权限错误
- [ ] 提示以管理员身份运行
- [ ] 保留原始文件

---

### 测试场景 4：更新器失败

**测试步骤**：
1. 手动删除 updater.exe（模拟）
2. 尝试安装更新

**预期结果**：
- [ ] 显示更新器不存在错误
- [ ] 不退出主程序
- [ ] 提供替代解决方案

---

## 📊 性能测试

### 下载速度
- [ ] 记录下载开始时间
- [ ] 记录下载完成时间
- [ ] 计算平均下载速度
- [ ] 预期：> 1 MB/s（取决于网络）

### 内存使用
- [ ] 下载前内存占用
- [ ] 下载中内存占用
- [ ] 验证：内存增长合理（< 100MB）

### CPU 使用
- [ ] 下载中 CPU 使用率
- [ ] 验证：CPU 使用合理（< 30%）

---

## ✅ 测试完成标准

### 成功标准
- [x] 所有 5 个阶段测试通过
- [x] 错误处理测试通过（至少 2 个场景）
- [x] 性能测试在可接受范围
- [x] 新版本功能完全正常

### 失败标准
- [ ] 任何核心功能失败
- [ ] 数据丢失或损坏
- [ ] 应用无法启动
- [ ] 无法恢复到旧版本

---

## 📝 测试记录

### 测试执行人
- 姓名: _______________
- 日期: _______________

### 测试结果
- 阶段 1（更新检测）: ✅ / ❌
- 阶段 2（更新对话框）: ✅ / ❌
- 阶段 3（下载）: ✅ / ❌
- 阶段 4（安装）: ✅ / ❌
- 阶段 5（新版本验证）: ✅ / ❌

### 发现的问题
1. 问题描述:
   - 严重程度: 🔴 高 / 🟡 中 / 🟢 低
   - 重现步骤:
   - 截图/日志:

2. 问题描述:
   - 严重程度: 🔴 高 / 🟡 中 / 🟢 低
   - 重现步骤:
   - 截图/日志:

### 改进建议
1. 功能建议:
2. UI/UX 改进:
3. 性能优化:

---

## 🎯 下一步行动

### 测试通过
- [ ] 合并 feature/auto-update 到 main 分支
- [ ] 创建 Pull Request
- [ ] 代码审查
- [ ] 发布正式版本

### 测试失败
- [ ] 记录问题到 Issue
- [ ] 修复 Bug
- [ ] 重新测试
- [ ] 验证修复

---

## 📚 相关文档

- 设计文档: `docs/plans/2026-02-02-auto-update-design.md`
- 实现计划: `docs/plans/2026-02-02-auto-update-implementation.md`
- 测试总结: `docs/test-auto-update-summary.md`
- 本文档: `docs/e2e-test-checklist.md`

---

**最后更新**: 2026-02-02
**版本**: 1.0
