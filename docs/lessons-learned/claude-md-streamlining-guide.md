# CLAUDE.md 精简优化指南

本文档总结了 CLAUDE.md 文件精简优化的方法论和最佳实践，适用于任何需要维护 CLAUDE.md 的项目。

## 理念

### CLAUDE.md 的定位

**CLAUDE.md 应该是：**
- 快速参考指南（Quick Reference）
- 项目的"地图"而非"百科全书"
- 开发者最常访问的入口文档
- 轻量级、易于扫描的信息集合

**CLAUDE.md 不应该是：**
- 包含所有细节的完整文档
- 代码教程和实现指南
- 频繁变化的详细规范
- 冗长的代码示例仓库

### 核心原则

**1. 信息分层（Information Layering）**
```
CLAUDE.md (快速参考) → 专门文档 (深度内容) → 代码 (终极真相)
```

**2. 单一职责（Single Responsibility）**
- CLAUDE.md：回答"这个项目是什么？如何开始？"
- 专门文档：回答"如何实现 X？有什么最佳实践？"
- 代码：回答"具体怎么写？"

**3. 就近原则（Proximity Principle）**
- 高频信息放在 CLAUDE.md
- 中频信息放在专门文档并链接
- 低频信息直接读代码

## 诊断方法

### 判断是否需要精简

#### 症状检查清单

- [ ] 文档行数超过 200 行
- [ ] 包含大量代码示例（超过 10 行）
- [ ] 包含详细的实现说明和教程
- [ ] 需要频繁滚动才能找到信息
- [ ] 包含频繁变化的规范和流程
- [ ] 新开发者反馈"信息太多，不知道从哪开始"

**如果勾选了 3 项以上，建议进行精简。**

#### 内容分析

使用以下命令分析文档结构：

```bash
# 统计行数
wc -l CLAUDE.md

# 查看主要章节分布
grep "^##" CLAUDE.md

# 查找代码块（可能是可移动的详细内容）
grep -c '^\`\`\`' CLAUDE.md
```

## 精简原则

### 应该保留在 CLAUDE.md

**必需内容（不可移除）：**
1. 项目概述（1-2 句话）
2. 开发环境（简洁列表）
3. 常用命令（开发、测试、构建）
4. 快速开始（最小可复现步骤）
5. 代码架构（目录结构，无详细描述）
6. 核心规则（5-7 条关键要点）
7. 配置文件位置
8. 常见问题（1-3 个高频问题）
9. 文档导航（指向所有详细文档）

**判断标准：**
- 是否每次开发都需要？→ 保留
- 是否是新开发者必须知道的？→ 保留
- 删除后是否影响日常工作？→ 保留

### 应该移到专门文档

**候选内容（应该移除）：**
1. 详细的架构描述（超过 3 行）
2. 完整的代码示例（超过 5 行）
3. 实现教程和步骤说明
4. 详细的规范和标准
5. 调试和故障排查指南
6. 历史记录和变更说明

**判断标准：**
- 是否是详细说明而非快速参考？→ 移除
- 是否可以独立成文档？→ 移除
- 是否需要频繁更新维护？→ 移除
- 是否只有特定场景需要？→ 移除

### 内容分层策略

**第 1 层：CLAUDE.md（50-150 行）**
```
项目概述 + 开发环境 + 常用命令 + 快速导航
```

**第 2 层：专门文档（docs/）**
```
docs/development/     # 开发规范和流程
docs/lessons-learned/ # 经验总结和最佳实践
docs/fixes/          # 问题修复记录
docs/guides/         # 专题指南
```

**第 3 层：代码（终极真相）**
```
代码注释 + 单元测试 + 示例代码
```

## 实施步骤

### 步骤 1：分析现状

**1.1 统计当前状态**
```bash
# 统计行数
wc -l CLAUDE.md

# 分析章节结构
grep -n "^##\|^###" CLAUDE.md
```

**1.2 识别冗余内容**
标记以下内容：
- 包含代码示例的段落（用 `CODE_EXAMPLE` 标记）
- 详细的实现说明（用 `DETAIL` 标记）
- 可能独立的主题（用 `TOPIC` 标记）

### 步骤 2：规划文档结构

**2.1 创建专门文档目录**

```bash
# 标准目录结构
mkdir -p docs/development    # 开发规范
mkdir -p docs/lessons-learned # 经验总结
mkdir -p docs/fixes          # 问题修复
mkdir -p docs/guides         # 专题指南
```

**2.2 制定内容迁移计划**

创建一个映射表：

| 原始位置（章节/行数） | 内容类型 | 目标文档 | 优先级 |
|---------------------|---------|---------|-------|
| 代码架构 (56-119行) | 详细描述 | docs/architecture/overview.md | 中 |
| 控制台窗口隐藏 (159-204行) | 代码示例 | docs/lessons-learned/windows-console-fix.md | 高 |
| 日志输出规范 (206-221行) | 代码示例 | docs/development/logging.md | 高 |

### 步骤 3：创建专门文档

**3.1 文档模板**

使用以下模板保持一致性：

```markdown
# [主题名称]

## 简述
一句话描述本文档的内容和价值。

## 问题描述
*如果是问题修复类文档*
- 症状是什么
- 影响范围
- 根本原因

## 解决方案
详细的实现步骤和代码示例

## 技术细节
深入的技术说明

## 使用场景
什么时候使用这个方法/技术

## 最佳实践
推荐的做法和注意事项

## 常见问题
Q: 常见问题1
A: 解答

## 相关文档
- [相关文档1](path/to/doc1)
- [相关文档2](path/to/doc2)
```

**3.2 内容提取原则**

从 CLAUDE.md 提取内容到专门文档时：
- ✅ 扩展说明和示例
- ✅ 添加更多上下文
- ✅ 补充最佳实践
- ✅ 添加常见问题
- ❌ 不要直接复制粘贴，要重新组织

### 步骤 4：重写 CLAUDE.md

**4.1 精简模板**

```markdown
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with this repository.

## 项目概述
[1-2 句话]

## 开发环境
[简洁列表]

## 常用命令
[开发、测试、构建命令]

## 代码架构
[目录结构列表，无详细描述]

## 开发规则
[5-7 条核心规则，引用专门文档]

## 配置文件位置
[路径和文件名]

## 常见问题
[1-3 个高频问题]

## 详细文档导航
[分类列出所有专门文档]
```

**4.2 精简技巧**

**技巧 1：删除详细描述，保留目录结构**
```markdown
# ❌ 精简前（64 行详细描述）
### 后端架构 (Go)
**App 层 (`app.go`)**: Wails 应用的入口，包含所有导出给前端的 API 方法
- 13 个公开方法：项目管理、Commit 生成、Git 操作、历史记录
- 持有 `context.Context` 用于调用 Wails runtime 方法
- 初始化时创建数据库连接和所有 Repository
...

# ✅ 精简后（8 行目录结构）
### 后端 (Go)
```
app.go                          # Wails 应用入口
pkg/service/                    # 业务逻辑层
pkg/repository/                 # 数据访问层
```
```

**技巧 2：代码示例移到专门文档，保留简短说明**
```markdown
# ❌ 精简前（46 行代码示例）
5. **控制台窗口隐藏**（Windows 平台）：
   [完整的代码示例和使用说明]

# ✅ 精简后（1 行引用）
### Wails 开发规范
详见：`docs/development/wails-development-standards.md`
- 使用自定义 `Command()` 函数隐藏 Windows 控制台窗口
```

**技巧 3：使用引用而非重复**
```markdown
# ❌ 精简前（重复详细内容）
### 通用规则
7. **日志库使用**: 统一使用 `github.com/WQGroup/logger` 日志库
   - 基本日志级别：`Debug()`、`Info()`、`Warn()`、`Error()`
   - 格式化版本：`Debugf()`、`Infof()`、`Warnf()`、`Errorf()`
   [更多详细说明...]

# ✅ 精简后（引用专门文档）
### 日志输出规范
详见：`docs/development/logging-standards.md`
- 统一使用 `github.com/WQGroup/logger` 日志库
- 支持多种日志级别和格式（JSON、文本）
```

### 步骤 5：验证和优化

**5.1 行数检查**
```bash
# 检查精简后的行数（目标：50-150 行）
wc -l CLAUDE.md
```

**5.2 内容完整性检查清单**

- [ ] 项目概述清晰
- [ ] 开发环境明确
- [ ] 常用命令完整
- [ ] 代码架构可见
- [ ] 核心规则突出
- [ ] 配置文件位置明确
- [ ] 常见问题已解答
- [ ] 文档导航清晰
- [ ] 所有链接有效
- [ ] Markdown 格式正确

**5.3 可读性测试**

```bash
# 渲染 Markdown 查看效果
# VS Code: Ctrl+Shift+V (预览)
# 或使用工具: glow CLAUDE.md
```

**5.4 链接验证**

```bash
# 检查文档链接是否有效（可选）
# 需要安装 markdown-link-check
npm install -g markdown-link-check
markdown-link-check CLAUDE.md
```

## 维护策略

### 定期审查

**每季度审查一次：**
1. 检查文档行数（是否又膨胀了？）
2. 检查链接有效性
3. 收集开发者反馈
4. 更新过时内容

### 触发精简的信号

当出现以下情况时，考虑再次精简：
- 文档行数增长超过 50%
- 新增了大量代码示例
- 包含了新的详细教程
- 开发者反馈"难以找到信息"

### 版本控制

**精简前后对比：**
```bash
# 创建备份
cp CLAUDE.md CLAUDE.md.backup

# 进行精简修改
git add CLAUDE.md docs/
git commit -m "docs: 精简 CLAUDE.md，将详细内容移到专门文档"
```

## 实际案例

### 案例：AI Commit Hub

**精简前：**
- 268 行
- 包含 64 行详细的架构描述
- 包含 46 行控制台窗口隐藏代码示例
- 包含 16 行日志输出代码示例

**精简后：**
- 122 行（减少 54.5%）
- 8 行简洁的目录结构
- 3 个专门文档（共 711 行）
- 清晰的文档导航

**创建的专门文档：**
1. `docs/development/logging-standards.md` (232 行)
2. `docs/development/wails-development-standards.md` (300 行)
3. `docs/lessons-learned/windows-console-hidden-fix.md` (179 行)

## 模板库

### 专门文档模板

**开发规范模板：**
```markdown
# [主题] 开发规范

## 概述
[简要说明这个规范的目的和适用范围]

## 核心原则
[3-5 条核心原则]

## 实施方法
[详细的实施步骤和代码示例]

## 最佳实践
[推荐的做法]

## 常见问题
[Q&A]

## 相关文档
[链接到相关文档]
```

**经验总结模板：**
```markdown
# [问题/主题] 实现总结

## 问题描述
[症状、影响、根本原因]

## 解决方案
[详细的实现步骤]

## 技术细节
[深入的技术说明]

## 注意事项
[实施时需要注意的点]

## 实际应用
[具体的使用示例]

## 相关文档
[链接到相关文档]
```

## 常见问题

### Q: 如何判断内容应该保留还是移除？

**A: 使用"5分钟测试"：**
- 如果开发者 5 分钟内找不到答案，保留在 CLAUDE.md
- 如果需要详细说明才能理解，移到专门文档
- 如果是特定场景的问题，移到专门文档

### Q: 精简后会不会丢失重要信息？

**A: 不会。精简是重新组织信息，不是删除信息：**
- 高频信息保留在 CLAUDE.md
- 详细信息通过链接可达
- 代码始终是终极真相

### Q: 专门文档太多会不会难以管理？

**A: 好的目录结构可以避免这个问题：**
- 按类型分类（development/lessons-learned/fixes）
- 在 CLAUDE.md 中提供清晰的导航
- 每个文档保持单一职责

### Q: 如何防止文档过时？

**A: 建立文档维护机制：**
- 代码修改时同步更新文档
- 定期审查文档准确性
- 收集开发者反馈
- 使用 CI 检查文档链接

### Q: 精简需要多长时间？

**A: 取决于文档规模：**
- 小型文档（<200 行）：1-2 小时
- 中型文档（200-500 行）：半天
- 大型文档（>500 行）：1-2 天

第一次精简投入较大，但后续维护成本会显著降低。

## 总结

### 核心理念

**CLAUDE.md = 项目地图 + 快速参考**
- 清晰简洁，一目了然
- 快速找到需要的方向
- 详细内容通过链接导航

### 关键成功因素

1. **明确目标**：CLAUDE.md 是参考指南，不是百科全书
2. **信息分层**：建立清晰的文档层级结构
3. **单一职责**：每个文档只负责一个主题
4. **持续维护**：定期审查和优化

### 预期收益

- **开发效率**：快速找到需要的信息
- **文档质量**：专门文档更深入、更准确
- **维护成本**：减少重复，提高可维护性
- **知识沉淀**：建立系统的知识库

## 参考资料

- [优秀的 CLAUDE.md 示例](https://github.com/anthropics/claude-code/blob/main/CLAUDE.md)
- [技术文档写作最佳实践](https://diataxis.fr/)
- [文档驱动开发](https://www.writethedocs.org/)

---

**文档版本**: 1.0
**最后更新**: 2025-02-05
**维护者**: 项目维护团队
