# AI Commit Hub è®¾è®¡æ–‡æ¡£

**æ—¥æœŸ**: 2025-01-22
**ç‰ˆæœ¬**: 1.0
**ä½œè€…**: Claude & User

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

å¼€å‘ä¸€ä¸ªç»Ÿä¸€çš„å¸¦ç•Œé¢çš„ Git Commit è‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒç®¡ç†å¤šä¸ªæœ¬åœ°é¡¹ç›®ï¼Œä¸€é”®ç”Ÿæˆ AI é©±åŠ¨çš„ commit æ¶ˆæ¯ã€‚

### 1.2 æ ¸å¿ƒéœ€æ±‚

- **å¤šé¡¹ç›®ç®¡ç†**: æ”¯æŒæ·»åŠ å¤šä¸ªæœ¬åœ° git ä»“åº“ï¼Œå¿«é€Ÿåˆ‡æ¢
- **AI Commit ç”Ÿæˆ**: åŸºäº ai-commit çš„æ ¸å¿ƒé€»è¾‘ï¼Œç”Ÿæˆç¬¦åˆ Conventional Commits è§„èŒƒçš„ commit æ¶ˆæ¯
- **é…ç½®ç®¡ç†**: ä½¿ç”¨ config.yaml ç®¡ç† AI provider é…ç½®
- **äº¤äº’æ“ä½œ**: æ”¯æŒç”Ÿæˆã€é‡è·‘ã€ç¼–è¾‘ commit æ¶ˆæ¯
- **æ— å†å²è®°å½•**: ä¸ä¿å­˜å†å² commit æ¶ˆæ¯ï¼Œåº”ç”¨é‡å¯åæ¸…ç©º

### 1.3 æŠ€æœ¯æ ˆ

- **åç«¯**: Go 1.22+ + Wails v2
- **å‰ç«¯**: Vue 3 + TypeScript + Vite + Pinia
- **æ•°æ®åº“**: SQLite (GORM)
- **Git æ“ä½œ**: go-git
- **AI é›†æˆ**: å¤ç”¨ ai-commit çš„ provider ç³»ç»Ÿ

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„æ¨¡å¼

é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼š
- **å±•ç¤ºå±‚**: Vue 3 å‰ç«¯ç»„ä»¶
- **ä¸šåŠ¡é€»è¾‘å±‚**: Go Service å±‚
- **æ•°æ®è®¿é—®å±‚**: GORM Repository
- **é›†æˆå±‚**: AI Providerã€Git æ“ä½œ

### 2.2 é¡¹ç›®ç»“æ„

```
ai-commit-hub/
â”œâ”€â”€ main.go                      # Wails å…¥å£
â”œâ”€â”€ app.go                       # ä¸»åº”ç”¨ç»“æ„
â”œâ”€â”€ go.mod / go.sum
â”œâ”€â”€ wails.json                   # Wails é…ç½®
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ git_project.go       # GitProject æ¨¡å‹
â”‚   â”œâ”€â”€ repository/              # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ db.go                # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ git_project_repo.go  # é¡¹ç›®ä»“åº“
â”‚   â”œâ”€â”€ service/                 # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ git_service.go       # Git æ“ä½œå°è£…
â”‚   â”‚   â”œâ”€â”€ ai_service.go        # AI Commit ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ config_service.go    # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ ai/                      # AI é›†æˆï¼ˆæ¥è‡ª ai-commitï¼‰
â”‚       â”œâ”€â”€ ai.go
â”‚       â”œâ”€â”€ provider/
â”‚       â””â”€â”€ prompt/
â”œâ”€â”€ frontend/                    # Vue 3 å‰ç«¯
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ MainLayout.vue   # ä¸»å¸ƒå±€ï¼ˆå·¦å³åˆ†æ ï¼‰
â”‚       â”‚   â”œâ”€â”€ ProjectList.vue  # é¡¹ç›®åˆ—è¡¨
â”‚       â”‚   â””â”€â”€ CommitDetail.vue # Commit è¯¦æƒ…
â”‚       â”œâ”€â”€ stores/
â”‚       â”‚   â”œâ”€â”€ projectStore.ts  # é¡¹ç›®çŠ¶æ€ç®¡ç†
â”‚       â”‚   â””â”€â”€ commitStore.ts   # Commit çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ types/
â”‚           â””â”€â”€ index.ts         # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ 2025-01-22-design.md     # æœ¬æ–‡æ¡£
â””â”€â”€ config/
    â””â”€â”€ config.yaml              # AI provider é…ç½®
```

## 3. æ•°æ®æ¨¡å‹

### 3.1 GitProject æ¨¡å‹

```go
type GitProject struct {
    ID        uint      `gorm:"primaryKey" json:"id"`
    Path      string    `gorm:"not null" json:"path"`
    Name      string    `json:"name"`
    SortOrder int       `gorm:"index" json:"sort_order"`
    CreatedAt time.Time `json:"created_at"`
    UpdatedAt time.Time `json:"updated_at"`
}
```

**å­—æ®µè¯´æ˜**:
- `Path`: Git ä»“åº“æœ¬åœ°è·¯å¾„ï¼ˆå­˜å‚¨ï¼‰
- `Name`: é¡¹ç›®åç§°ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰
- `SortOrder`: åˆ—è¡¨æ’åºä½ç½®

## 4. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 4.1 ä¸»ç•Œé¢å¸ƒå±€ï¼ˆå·¦å³åˆ†æ ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Commit Hub                                              â–¡ - â–¡ Ã—  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ æ·»åŠ é¡¹ç›®] [âš™ è®¾ç½®]                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¡¹ç›®åˆ—è¡¨]          â”‚  [Commit è¯¦æƒ…]                                â”‚
â”‚  [ğŸ” æœç´¢...]        â”‚                                               â”‚
â”‚                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â‹®â‹® (æ‹–æ‹½æ’åº)      â”‚  â”‚                                        â”‚  â”‚
â”‚                      â”‚  â”‚  é¡¹ç›®: daily-recorder                   â”‚  â”‚
â”‚  1. ğŸ“ project-a     â”‚  â”‚  åˆ†æ”¯: main                              â”‚  â”‚
â”‚  2. ğŸ“ daily-recorderâ”‚  â”‚  å˜æ›´: 3 ä¸ªæ–‡ä»¶                          â”‚  â”‚
â”‚  3. ğŸ“ ai-commit-hub â”‚  â”‚                                        â”‚  â”‚
â”‚  4. ğŸ“ another-proj  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚  â”‚
â”‚                      â”‚  â”‚                                        â”‚  â”‚
â”‚       â†‘              â”‚  â”‚  feat: æ·»åŠ é¡¹ç›®åˆ—è¡¨ç®¡ç†åŠŸèƒ½               â”‚  â”‚
â”‚                      â”‚  â”‚                                        â”‚  â”‚
â”‚  15. ğŸ“ last-project â”‚  â”‚  - å®ç° GitProject æ•°æ®æ¨¡å‹              â”‚  â”‚
â”‚                      â”‚  â”‚  - æ·»åŠ é¡¹ç›®åˆ—è¡¨ UI ç»„ä»¶                  â”‚  â”‚
â”‚                      â”‚  â”‚  - æ”¯æŒæ‹–æ‹½æ’åº                          â”‚  â”‚
â”‚                      â”‚  â”‚                                        â”‚  â”‚
â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                               â”‚
â”‚                      â”‚  [ğŸ”„ é‡æ–°ç”Ÿæˆ]  [âœï¸ ç¼–è¾‘]  [âœ“ ç¡®è®¤æäº¤]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å·¦ä¾§é¢æ¿ - é¡¹ç›®åˆ—è¡¨

**åŠŸèƒ½**:
- æœç´¢è¿‡æ»¤ï¼ˆå®æ—¶ï¼‰
- æ‹–æ‹½æ’åº
- ç‚¹å‡»é€‰æ‹©
- ä¸Šç§»/ä¸‹ç§»æŒ‰é’®
- åˆ é™¤é¡¹ç›®

**äº¤äº’**:
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ“ä½œæŒ‰é’®
- æ‹–æ‹½æ‰‹æŸ„ï¼šâ‹®â‹®
- é€‰ä¸­çŠ¶æ€ï¼šè“è‰²é«˜äº®

### 4.3 å³ä¾§é¢æ¿ - Commit è¯¦æƒ…

**åŠŸèƒ½**:
- æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯ï¼ˆè·¯å¾„ã€åˆ†æ”¯ã€æ–‡ä»¶æ•°ï¼‰
- Commit æ¶ˆæ¯é¢„è§ˆ
- é‡æ–°ç”Ÿæˆï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- ç¼–è¾‘æ¶ˆæ¯
- ç¡®è®¤æäº¤
- Diff é¢„è§ˆï¼ˆæŠ˜å ï¼‰

## 5. åç«¯ API è®¾è®¡

### 5.1 é¡¹ç›®ç®¡ç†

```go
// GetAllProjects è·å–æ‰€æœ‰é¡¹ç›®
GetAllProjects() ([]GitProject, error)

// AddProject æ·»åŠ é¡¹ç›®
AddProject(path string) (GitProject, error)

// DeleteProject åˆ é™¤é¡¹ç›®
DeleteProject(id uint) error

// MoveProject ç§»åŠ¨é¡¹ç›®ä½ç½®
MoveProject(id uint, direction string) error  // direction: "up" | "down"

// ReorderProjects æ‰¹é‡æ’åº
ReorderProjects(projects []GitProject) error

// SearchProjects æœç´¢é¡¹ç›®
SearchProjects(query string) ([]GitProject, error)
```

### 5.2 Git æ“ä½œ

```go
// GetProjectInfo è·å–é¡¹ç›®ä¿¡æ¯
GetProjectInfo(projectID uint) (map[string]interface{}, error)
// è¿”å›: { branch, files_changed, has_staged_changes }

// GetGitDiff è·å– diff
GetGitDiff(projectID uint) (string, error)
```

### 5.3 AI Commit ç”Ÿæˆ

```go
// GenerateCommitMessage ç”Ÿæˆ commit æ¶ˆæ¯
GenerateCommitMessage(projectID uint) (string, error)

// RegenerateCommitMessage é‡æ–°ç”Ÿæˆ
RegenerateCommitMessage(projectID uint) (string, error)

// CommitChanges æ‰§è¡Œ commit
CommitChanges(projectID uint, message string) error
```

### 5.4 é…ç½®ç®¡ç†

```go
// OpenConfigFolder æ‰“å¼€é…ç½®æ–‡ä»¶å¤¹
OpenConfigFolder() error

// ReloadConfig é‡æ–°åŠ è½½é…ç½®
ReloadConfig() error
```

## 6. æ•°æ®æµ

### 6.1 æ·»åŠ é¡¹ç›®æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"æ·»åŠ é¡¹ç›®"
    â†“
æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡†
    â†“
é€‰æ‹©è·¯å¾„ â†’ AddProject(path)
    â†“
éªŒè¯ git ä»“åº“
    â”œâ”€ å¤±è´¥ â†’ è¿”å›é”™è¯¯
    â””â”€ æˆåŠŸ â†’ ç»§ç»­
        â†“
    è‡ªåŠ¨æ£€æµ‹é¡¹ç›®å
        â†“
    åˆ†é… sort_order
        â†“
    ä¿å­˜æ•°æ®åº“
        â†“
    åˆ·æ–°åˆ—è¡¨
```

### 6.2 ç”Ÿæˆ Commit æµç¨‹

```
é€‰æ‹©é¡¹ç›® â†’ ç‚¹å‡»"ç”Ÿæˆ Commit"
    â†“
GetProjectInfo()
    â†“
æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
    â†“
GenerateCommitMessage()
    â†“
    â”œâ”€ åŠ è½½ config.yaml
    â”œâ”€ åˆå§‹åŒ– AI client
    â”œâ”€ æ„å»º prompt
    â””â”€ è°ƒç”¨ AI
        â†“
    è¿”å› commit message
        â†“
    æ˜¾ç¤ºé¢„è§ˆ
        â†“
ç”¨æˆ·æ“ä½œï¼š
    â”œâ”€ é‡æ–°ç”Ÿæˆ â†’ RegenerateCommitMessage()
    â”œâ”€ ç¼–è¾‘ â†’ å†…è”ç¼–è¾‘
    â””â”€ ç¡®è®¤ â†’ CommitChanges()
```

### 6.3 æ’åºæµç¨‹

```
æ‹–æ‹½é¡¹ç›®
    â†“
dragstart: è®°å½•æºé¡¹ç›®
    â†“
dragover: å…è®¸æ”¾ç½®
    â†“
drop: è®¡ç®—æ–°ä½ç½®
    â†“
ReorderProjects(æ–°é¡ºåº)
    â†“
æ‰¹é‡æ›´æ–° sort_order
    â†“
åˆ·æ–°åˆ—è¡¨
```

## 7. é”™è¯¯å¤„ç†

### 7.1 å‰ç«¯é”™è¯¯ç±»å‹

| é”™è¯¯ç±»å‹ | æ˜¾ç¤ºæ¶ˆæ¯ | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| API Key é”™è¯¯ | "API å¯†é’¥é…ç½®é”™è¯¯" | æç¤ºæ‰“å¼€é…ç½® |
| è¯·æ±‚è¶…æ—¶ | "AI è¯·æ±‚è¶…æ—¶" | æ˜¾ç¤ºé‡è¯•æŒ‰é’® |
| é Git ä»“åº“ | "ä¸æ˜¯æœ‰æ•ˆçš„ Git ä»“åº“" | é˜»æ­¢æ·»åŠ  |
| ç½‘ç»œé”™è¯¯ | "ç½‘ç»œè¿æ¥å¤±è´¥" | æ˜¾ç¤ºé‡è¯• |
| æ— å˜æ›´ | "æ²¡æœ‰å¯æäº¤çš„å˜æ›´" | ç¦ç”¨æŒ‰é’® |

### 7.2 åç«¯é”™è¯¯å¤„ç†

```go
// é…ç½®æ£€æŸ¥
if cfg.Providers[cfg.Provider].APIKey == "" {
    return "", fmt.Errorf("æœªé…ç½® API key")
}

// è¶…æ—¶å¤„ç†
ctx, cancel := context.WithTimeout(ctx, 60*time.Second)
defer cancel()

// Git éªŒè¯
if !git.IsGitRepository(path) {
    return "", fmt.Errorf("ä¸æ˜¯æœ‰æ•ˆçš„ git ä»“åº“")
}
```

## 8. AI é›†æˆ

### 8.1 å¤ç”¨ ai-commit ç»„ä»¶

ä» `ai-commit` é¡¹ç›®æå–ä»¥ä¸‹åŒ…ï¼š
- `pkg/ai/` - AI å®¢æˆ·ç«¯æ¥å£
- `pkg/provider/` - AI providers
- `pkg/git/` - Git æ“ä½œ
- `pkg/prompt/` - Prompt æ¨¡æ¿
- `pkg/config/` - é…ç½®åŠ è½½

### 8.2 é…ç½®æ–‡ä»¶æ ¼å¼

å¤ç”¨ ai-commit çš„ `config.yaml` æ ¼å¼ï¼š

```yaml
provider: "openai"
language: "chinese"
authorName: "Your Name"
authorEmail: "you@example.com"

providers:
  openai:
    apiKey: "sk-..."
    model: "gpt-4o"
    baseURL: "https://api.openai.com/v1"
  anthropic:
    apiKey: "sk-ant-..."
    model: "claude-3-5-sonnet-20241022"
    baseURL: "https://api.anthropic.com"

commitTypes:
  - type: "feat" emoji: "âœ¨"
  - type: "fix" emoji: "ğŸ›"
  # ...
```

é…ç½®è·¯å¾„ï¼š`~/.config/ai-commit-hub/config.yaml`

## 9. å®ç°è®¡åˆ’

### 9.1 é˜¶æ®µåˆ’åˆ†

**é˜¶æ®µ 1: åŸºç¡€æ¡†æ¶**
- åˆå§‹åŒ– Wails é¡¹ç›®
- è®¾ç½®æ•°æ®åº“
- å®ç°åŸºç¡€ UI æ¡†æ¶

**é˜¶æ®µ 2: é¡¹ç›®ç®¡ç†**
- æ·»åŠ /åˆ é™¤é¡¹ç›®
- é¡¹ç›®åˆ—è¡¨å±•ç¤º
- æœç´¢åŠŸèƒ½

**é˜¶æ®µ 3: æ’åºåŠŸèƒ½**
- æ‹–æ‹½æ’åº
- æŒ‰é’®æ’åº
- æ•°æ®æŒä¹…åŒ–

**é˜¶æ®µ 4: AI é›†æˆ**
- é›†æˆ ai-commit æ ¸å¿ƒé€»è¾‘
- å®ç°ç”Ÿæˆ commit æ¶ˆæ¯
- é‡è·‘åŠŸèƒ½

**é˜¶æ®µ 5: å®Œå–„ä½“éªŒ**
- ç¼–è¾‘åŠŸèƒ½
- é”™è¯¯å¤„ç†
- é…ç½®ç®¡ç†

### 9.2 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| AI API ä¸ç¨³å®š | ç”Ÿæˆå¤±è´¥ | æ·»åŠ é‡è¯•æœºåˆ¶ã€å‹å¥½é”™è¯¯æç¤º |
| go-git å…¼å®¹æ€§ | Git æ“ä½œå¤±è´¥ | é™çº§åˆ° git å‘½ä»¤è¡Œ |
| å¤§é¡¹ç›®æ€§èƒ½ | åˆ—è¡¨å¡é¡¿ | è™šæ‹Ÿæ»šåŠ¨ã€åˆ†é¡µåŠ è½½ |

## 10. å‚è€ƒèµ„æ–™

- [ai-commit](https://github.com/renatogalera/ai-commit)
- [daily_recorder](https://github.com/allanpk716/daily_recorder)
- [Wails æ–‡æ¡£](https://wails.io/docs/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
